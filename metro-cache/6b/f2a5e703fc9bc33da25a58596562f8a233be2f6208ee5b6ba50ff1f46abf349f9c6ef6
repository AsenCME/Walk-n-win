{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/regenerator","data":{"isAsync":false}},{"name":"moment","data":{"isAsync":false}},{"name":"../../firebase","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.fetchCodes = fetchCodes;\n  exports.selectCompany = selectCompany;\n  exports.SELECT_COMPANY = exports.LAST_FETCH = exports.FETCH_CODE_ERROR = exports.FETCH_CODE_SUCCESS = exports.FETCH_CODES_START = void 0;\n\n  var _regenerator = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/regenerator\"));\n\n  var _moment = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"moment\"));\n\n  var _firebase = _$$_REQUIRE(_dependencyMap[3], \"../../firebase\");\n\n  var FETCH_CODES_START = 'FETCH_CODES_START';\n  exports.FETCH_CODES_START = FETCH_CODES_START;\n  var FETCH_CODE_SUCCESS = 'FETCH_CODE_SUCCESS';\n  exports.FETCH_CODE_SUCCESS = FETCH_CODE_SUCCESS;\n  var FETCH_CODE_ERROR = 'FETCH_CODE_ERROR';\n  exports.FETCH_CODE_ERROR = FETCH_CODE_ERROR;\n  var LAST_FETCH = 'LAST_FETCH';\n  exports.LAST_FETCH = LAST_FETCH;\n  var SELECT_COMPANY = 'SELECT_COMPANY';\n  exports.SELECT_COMPANY = SELECT_COMPANY;\n\n  function fetchCodes() {\n    return function _callee(dispatch, getState) {\n      var state, lastFetch, result, companies, promiseArr, companyCodes;\n      return _regenerator.default.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch(startCodeFetching());\n              state = getState();\n              lastFetch = state.codes.lastFetch;\n              console.log(lastFetch);\n\n              if (!(lastFetch && _moment.default.unix(lastFetch).isAfter((0, _moment.default)().subtract(1, 'hour')))) {\n                _context.next = 7;\n                break;\n              }\n\n              dispatch(codeFetchingSuccess(state.codes.codes));\n              return _context.abrupt(\"return\");\n\n            case 7:\n              _context.prev = 7;\n              result = [];\n              _context.next = 11;\n              return _regenerator.default.awrap(_firebase.firestore.collection('companies').limit(5).get());\n\n            case 11:\n              companies = _context.sent;\n              promiseArr = [];\n              companies.forEach(function (company) {\n                var data = company.data();\n                result.push({\n                  storeName: data.name,\n                  logoImage: data.logoUrl,\n                  backgroundImage: data.backgroundUrl,\n                  codes: []\n                });\n                promiseArr.push(_firebase.firestore.collection('companies').doc(company.id).collection('codes').get());\n              });\n              _context.next = 16;\n              return _regenerator.default.awrap(Promise.all(promiseArr));\n\n            case 16:\n              companyCodes = _context.sent;\n              companyCodes.forEach(function (item, i) {\n                if (!item.empty) {\n                  item.docs.forEach(function (code) {\n                    code = code.data();\n                    var codeObj = {\n                      name: code.name,\n                      description: code.description,\n                      inStock: code.currentStock,\n                      discount: code.discount,\n                      price: code.price,\n                      codeVariations: code.codes\n                    };\n                    result[i].codes.push(codeObj);\n                  });\n                }\n              });\n              dispatch(codeFetchingSuccess(result));\n              dispatch(codeLastFetch(Math.floor(Date.now() / 1000)));\n              _context.next = 25;\n              break;\n\n            case 22:\n              _context.prev = 22;\n              _context.t0 = _context[\"catch\"](7);\n              dispatch(codeFetchingError(_context.t0.message));\n\n            case 25:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[7, 22]]);\n    };\n  }\n\n  function startCodeFetching() {\n    return {\n      type: FETCH_CODES_START\n    };\n  }\n\n  function codeFetchingSuccess(codes) {\n    return {\n      type: FETCH_CODE_SUCCESS,\n      codes: codes\n    };\n  }\n\n  function codeFetchingError(error) {\n    return {\n      type: FETCH_CODE_ERROR,\n      error: error\n    };\n  }\n\n  function codeLastFetch(lastFetch) {\n    return {\n      type: LAST_FETCH,\n      lastFetch: lastFetch\n    };\n  }\n\n  function selectCompany(index) {\n    return {\n      type: SELECT_COMPANY,\n      index: index\n    };\n  }\n});","map":[[13,0,1,0],[15,0,2,0],[17,0,4,7],[17,6,4,13,"FETCH_CODES_START"],[17,23,4,30],[17,26,4,33],[17,45,4,7],[19,0,5,7],[19,6,5,13,"FETCH_CODE_SUCCESS"],[19,24,5,31],[19,27,5,34],[19,47,5,7],[21,0,6,7],[21,6,6,13,"FETCH_CODE_ERROR"],[21,22,6,29],[21,25,6,32],[21,43,6,7],[23,0,7,7],[23,6,7,13,"LAST_FETCH"],[23,16,7,23],[23,19,7,26],[23,31,7,7],[25,0,8,7],[25,6,8,13,"SELECT_COMPANY"],[25,20,8,27],[25,23,8,30],[25,39,8,7],[28,0,10,7],[28,11,10,16,"fetchCodes"],[28,21,10,7],[28,24,10,29],[29,0,11,4],[29,11,11,11],[29,28,11,18,"dispatch"],[29,36,11,11],[29,38,11,28,"getState"],[29,46,11,11],[30,0,11,11],[31,0,11,11],[32,0,11,11],[33,0,11,11],[34,0,11,11],[35,0,12,8,"dispatch"],[35,14,12,8,"dispatch"],[35,22,12,16],[35,23,12,17,"startCodeFetching"],[35,40,12,34],[35,42,12,16],[35,43,12,8],[36,0,13,14,"state"],[36,14,13,14,"state"],[36,19,11,11],[36,22,13,22,"getState"],[36,30,13,30],[36,32,11,11],[37,0,14,14,"lastFetch"],[37,14,14,14,"lastFetch"],[37,23,11,11],[37,26,14,26,"state"],[37,31,14,31],[37,32,14,32,"codes"],[37,37,14,26],[37,38,14,38,"lastFetch"],[37,47,11,11],[38,0,15,8,"console"],[38,14,15,8,"console"],[38,21,15,15],[38,22,15,16,"log"],[38,25,15,8],[38,26,15,20,"lastFetch"],[38,35,15,8],[40,0,11,11],[40,20,17,11,"lastFetch"],[40,29,17,20],[40,33,17,24,"moment"],[40,49,17,31,"unix"],[40,53,17,24],[40,54,17,36,"lastFetch"],[40,63,17,24],[40,65,17,47,"isAfter"],[40,72,17,24],[40,73,17,55],[40,96,17,64,"subtract"],[40,104,17,55],[40,105,17,73],[40,106,17,55],[40,108,17,76],[40,114,17,55],[40,115,17,24],[40,116,11,11],[41,0,11,11],[42,0,11,11],[43,0,11,11],[45,0,18,12,"dispatch"],[45,14,18,12,"dispatch"],[45,22,18,20],[45,23,18,21,"codeFetchingSuccess"],[45,42,18,40],[45,43,18,41,"state"],[45,48,18,46],[45,49,18,47,"codes"],[45,54,18,41],[45,55,18,53,"codes"],[45,60,18,40],[45,61,18,20],[45,62,18,12],[46,0,11,11],[48,0,11,11],[49,0,11,11],[50,0,23,18,"result"],[50,14,23,18,"result"],[50,20,11,11],[50,23,23,27],[50,25,11,11],[51,0,11,11],[52,0,11,11],[52,48,24,36,"firestore"],[52,68,24,46,"collection"],[52,78,24,36],[52,79,24,57],[52,90,24,36],[52,92,24,70,"limit"],[52,97,24,36],[52,98,24,76],[52,99,24,36],[52,101,24,79,"get"],[52,104,24,36],[52,106,11,11],[54,0,11,11],[55,0,24,18,"companies"],[55,14,24,18,"companies"],[55,23,11,11],[56,0,25,18,"promiseArr"],[56,14,25,18,"promiseArr"],[56,24,11,11],[56,27,25,31],[56,29,11,11],[57,0,27,12,"companies"],[57,14,27,12,"companies"],[57,23,27,21],[57,24,27,22,"forEach"],[57,31,27,12],[57,32,27,30],[57,42,27,30,"company"],[57,49,27,37],[57,51,27,41],[58,0,28,16],[58,20,28,22,"data"],[58,24,28,26],[58,27,28,29,"company"],[58,34,28,36],[58,35,28,37,"data"],[58,39,28,29],[58,41,28,16],[59,0,30,16,"result"],[59,16,30,16,"result"],[59,22,30,22],[59,23,30,23,"push"],[59,27,30,16],[59,28,30,28],[60,0,31,20,"storeName"],[60,18,31,20,"storeName"],[60,27,31,29],[60,29,31,31,"data"],[60,33,31,35],[60,34,31,36,"name"],[60,38,30,28],[61,0,32,20,"logoImage"],[61,18,32,20,"logoImage"],[61,27,32,29],[61,29,32,31,"data"],[61,33,32,35],[61,34,32,36,"logoUrl"],[61,41,30,28],[62,0,33,20,"backgroundImage"],[62,18,33,20,"backgroundImage"],[62,33,33,35],[62,35,33,37,"data"],[62,39,33,41],[62,40,33,42,"backgroundUrl"],[62,53,30,28],[63,0,34,20,"codes"],[63,18,34,20,"codes"],[63,23,34,25],[63,25,34,27],[64,0,30,28],[64,17,30,16],[65,0,37,16,"promiseArr"],[65,16,37,16,"promiseArr"],[65,26,37,26],[65,27,37,27,"push"],[65,31,37,16],[65,32,38,20,"firestore"],[65,52,38,30,"collection"],[65,62,38,20],[65,63,38,41],[65,74,38,20],[65,76,38,54,"doc"],[65,79,38,20],[65,80,38,58,"company"],[65,87,38,65],[65,88,38,66,"id"],[65,90,38,20],[65,92,38,70,"collection"],[65,102,38,20],[65,103,38,81],[65,110,38,20],[65,112,38,90,"get"],[65,115,38,20],[65,117,37,16],[66,0,40,13],[66,15,27,12],[67,0,11,11],[68,0,11,11],[68,48,42,39,"Promise"],[68,55,42,46],[68,56,42,47,"all"],[68,59,42,39],[68,60,42,51,"promiseArr"],[68,70,42,39],[68,71,11,11],[70,0,11,11],[71,0,42,18,"companyCodes"],[71,14,42,18,"companyCodes"],[71,26,11,11],[72,0,44,12,"companyCodes"],[72,14,44,12,"companyCodes"],[72,26,44,24],[72,27,44,25,"forEach"],[72,34,44,12],[72,35,44,33],[72,45,44,34,"item"],[72,49,44,33],[72,51,44,40,"i"],[72,52,44,33],[72,54,44,46],[73,0,46,16],[73,20,46,19],[73,21,46,20,"item"],[73,25,46,24],[73,26,46,25,"empty"],[73,31,46,16],[73,33,46,32],[74,0,47,20,"item"],[74,18,47,20,"item"],[74,22,47,24],[74,23,47,25,"docs"],[74,27,47,20],[74,28,47,30,"forEach"],[74,35,47,20],[74,36,47,38],[74,46,47,38,"code"],[74,50,47,42],[74,52,47,46],[75,0,48,24,"code"],[75,20,48,24,"code"],[75,24,48,28],[75,27,48,31,"code"],[75,31,48,35],[75,32,48,36,"data"],[75,36,48,31],[75,38,48,24],[76,0,49,23],[76,24,49,29,"codeObj"],[76,31,49,36],[76,34,49,39],[77,0,50,27,"name"],[77,22,50,27,"name"],[77,26,50,31],[77,28,50,33,"code"],[77,32,50,37],[77,33,50,38,"name"],[77,37,49,39],[78,0,51,27,"description"],[78,22,51,27,"description"],[78,33,51,38],[78,35,51,40,"code"],[78,39,51,44],[78,40,51,45,"description"],[78,51,49,39],[79,0,52,27,"inStock"],[79,22,52,27,"inStock"],[79,29,52,34],[79,31,52,36,"code"],[79,35,52,40],[79,36,52,41,"currentStock"],[79,48,49,39],[80,0,53,27,"discount"],[80,22,53,27,"discount"],[80,30,53,35],[80,32,53,37,"code"],[80,36,53,41],[80,37,53,42,"discount"],[80,45,49,39],[81,0,54,27,"price"],[81,22,54,27,"price"],[81,27,54,32],[81,29,54,34,"code"],[81,33,54,38],[81,34,54,39,"price"],[81,39,49,39],[82,0,55,27,"codeVariations"],[82,22,55,27,"codeVariations"],[82,36,55,41],[82,38,55,43,"code"],[82,42,55,47],[82,43,55,48,"codes"],[83,0,49,39],[83,21,49,23],[84,0,58,23,"result"],[84,20,58,23,"result"],[84,26,58,29],[84,27,58,30,"i"],[84,28,58,29],[84,29,58,23],[84,30,58,33,"codes"],[84,35,58,23],[84,36,58,39,"push"],[84,40,58,23],[84,41,58,44,"codeObj"],[84,48,58,23],[85,0,59,21],[85,19,47,20],[86,0,60,17],[87,0,62,13],[87,15,44,12],[88,0,64,12,"dispatch"],[88,14,64,12,"dispatch"],[88,22,64,20],[88,23,64,21,"codeFetchingSuccess"],[88,42,64,40],[88,43,64,41,"result"],[88,49,64,40],[88,50,64,20],[88,51,64,12],[89,0,65,12,"dispatch"],[89,14,65,12,"dispatch"],[89,22,65,20],[89,23,65,21,"codeLastFetch"],[89,36,65,34],[89,37,65,35,"Math"],[89,41,65,39],[89,42,65,40,"floor"],[89,47,65,35],[89,48,65,46,"Date"],[89,52,65,50],[89,53,65,51,"now"],[89,56,65,46],[89,61,65,59],[89,65,65,35],[89,66,65,34],[89,67,65,20],[89,68,65,12],[90,0,11,11],[91,0,11,11],[93,0,11,11],[94,0,11,11],[95,0,11,11],[96,0,68,12,"dispatch"],[96,14,68,12,"dispatch"],[96,22,68,20],[96,23,68,21,"codeFetchingError"],[96,40,68,38],[96,41,68,39],[96,53,68,45,"message"],[96,60,68,38],[96,61,68,20],[96,62,68,12],[98,0,11,11],[99,0,11,11],[100,0,11,11],[101,0,11,11],[102,0,11,11],[103,0,11,11],[104,0,11,11],[104,5,11,4],[105,0,72,1],[107,0,74,0],[107,11,74,9,"startCodeFetching"],[107,28,74,0],[107,31,74,29],[108,0,75,4],[108,11,75,11],[109,0,76,8,"type"],[109,6,76,8,"type"],[109,10,76,12],[109,12,76,14,"FETCH_CODES_START"],[110,0,75,11],[110,5,75,4],[111,0,78,1],[113,0,80,0],[113,11,80,9,"codeFetchingSuccess"],[113,30,80,0],[113,31,80,29,"codes"],[113,36,80,0],[113,38,80,36],[114,0,81,4],[114,11,81,11],[115,0,82,8,"type"],[115,6,82,8,"type"],[115,10,82,12],[115,12,82,14,"FETCH_CODE_SUCCESS"],[115,30,81,11],[116,0,83,8,"codes"],[116,6,83,8,"codes"],[116,11,83,13],[116,13,83,8,"codes"],[117,0,81,11],[117,5,81,4],[118,0,85,1],[120,0,87,0],[120,11,87,9,"codeFetchingError"],[120,28,87,0],[120,29,87,27,"error"],[120,34,87,0],[120,36,87,34],[121,0,88,4],[121,11,88,11],[122,0,89,8,"type"],[122,6,89,8,"type"],[122,10,89,12],[122,12,89,14,"FETCH_CODE_ERROR"],[122,28,88,11],[123,0,90,8,"error"],[123,6,90,8,"error"],[123,11,90,13],[123,13,90,8,"error"],[124,0,88,11],[124,5,88,4],[125,0,92,1],[127,0,94,0],[127,11,94,9,"codeLastFetch"],[127,24,94,0],[127,25,94,23,"lastFetch"],[127,34,94,0],[127,36,94,34],[128,0,95,4],[128,11,95,11],[129,0,96,8,"type"],[129,6,96,8,"type"],[129,10,96,12],[129,12,96,14,"LAST_FETCH"],[129,22,95,11],[130,0,97,8,"lastFetch"],[130,6,97,8,"lastFetch"],[130,15,97,17],[130,17,97,8,"lastFetch"],[131,0,95,11],[131,5,95,4],[132,0,99,1],[134,0,101,7],[134,11,101,16,"selectCompany"],[134,24,101,7],[134,25,101,30,"index"],[134,30,101,7],[134,32,101,37],[135,0,102,4],[135,11,102,11],[136,0,103,8,"type"],[136,6,103,8,"type"],[136,10,103,12],[136,12,103,14,"SELECT_COMPANY"],[136,26,102,11],[137,0,104,8,"index"],[137,6,104,8,"index"],[137,11,104,13],[137,13,104,8,"index"],[138,0,102,11],[138,5,102,4],[139,0,106,1]]},"type":"js/module"}]}