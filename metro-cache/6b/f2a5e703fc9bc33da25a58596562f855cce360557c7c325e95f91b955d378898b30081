{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/regenerator","data":{"isAsync":false}},{"name":"moment","data":{"isAsync":false}},{"name":"../../firebase","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.fetchCodes = fetchCodes;\n  exports.LAST_FETCH = exports.FETCH_CODE_ERROR = exports.FETCH_CODE_SUCCESS = exports.FETCH_CODES_START = void 0;\n\n  var _regenerator = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/regenerator\"));\n\n  var _moment = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"moment\"));\n\n  var _firebase = _$$_REQUIRE(_dependencyMap[3], \"../../firebase\");\n\n  var FETCH_CODES_START = 'FETCH_CODES_START';\n  exports.FETCH_CODES_START = FETCH_CODES_START;\n  var FETCH_CODE_SUCCESS = 'FETCH_CODE_SUCCESS';\n  exports.FETCH_CODE_SUCCESS = FETCH_CODE_SUCCESS;\n  var FETCH_CODE_ERROR = 'FETCH_CODE_ERROR';\n  exports.FETCH_CODE_ERROR = FETCH_CODE_ERROR;\n  var LAST_FETCH = 'LAST_FETCH';\n  exports.LAST_FETCH = LAST_FETCH;\n\n  function fetchCodes() {\n    return function _callee(dispatch, getState) {\n      var state, lastFetch, result, companies, promiseArr, companyCodes;\n      return _regenerator.default.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch(startCodeFetching());\n              state = getState();\n              lastFetch = state.codes.lastFetch;\n              console.log(lastFetch);\n\n              if (!(lastFetch && _moment.default.unix(lastFetch).subtract('hour', 1).isAfter((0, _moment.default)().subtract('hour', 1)))) {\n                _context.next = 7;\n                break;\n              }\n\n              dispatch(codeFetchingSuccess(state.codes.codes));\n              return _context.abrupt(\"return\");\n\n            case 7:\n              console.log('continue fetching codes');\n              _context.prev = 8;\n              result = [];\n              _context.next = 12;\n              return _regenerator.default.awrap(_firebase.firestore.collection('companies').limit(5).get());\n\n            case 12:\n              companies = _context.sent;\n              promiseArr = [];\n              companies.forEach(function (company) {\n                var data = company.data();\n                result.push({\n                  storeName: data.name,\n                  logoImage: data.logoUrl,\n                  backgroundImage: data.backgroundUrl,\n                  codes: []\n                });\n                promiseArr.push(_firebase.firestore.collection('companies').doc(company.id).collection('codes').get());\n              });\n              _context.next = 17;\n              return _regenerator.default.awrap(Promise.all(promiseArr));\n\n            case 17:\n              companyCodes = _context.sent;\n              companyCodes.forEach(function (item, i) {\n                if (!item.empty) {\n                  item.docs.forEach(function (code) {\n                    code = code.data();\n                    var codeObj = {\n                      name: code.name,\n                      description: code.description,\n                      inStock: code.currentStock,\n                      discount: code.discount,\n                      price: code.price\n                    };\n                    result[i].codes.push(codeObj);\n                  });\n                }\n              });\n              dispatch(codeFetchingSuccess(result));\n              dispatch(codeLastFetch(Math.floor(Date.now() / 1000)));\n              _context.next = 26;\n              break;\n\n            case 23:\n              _context.prev = 23;\n              _context.t0 = _context[\"catch\"](8);\n              dispatch(codeFetchingError(_context.t0.message));\n\n            case 26:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[8, 23]]);\n    };\n  }\n\n  function startCodeFetching() {\n    return {\n      type: FETCH_CODES_START\n    };\n  }\n\n  function codeFetchingSuccess(codes) {\n    return {\n      type: FETCH_CODE_SUCCESS,\n      codes: codes\n    };\n  }\n\n  function codeFetchingError(error) {\n    return {\n      type: FETCH_CODE_ERROR,\n      error: error\n    };\n  }\n\n  function codeLastFetch(lastFetch) {\n    return {\n      type: LAST_FETCH,\n      lastFetch: lastFetch\n    };\n  }\n});","map":[[12,0,1,0],[14,0,2,0],[16,0,4,7],[16,6,4,13,"FETCH_CODES_START"],[16,23,4,30],[16,26,4,33],[16,45,4,7],[18,0,5,7],[18,6,5,13,"FETCH_CODE_SUCCESS"],[18,24,5,31],[18,27,5,34],[18,47,5,7],[20,0,6,7],[20,6,6,13,"FETCH_CODE_ERROR"],[20,22,6,29],[20,25,6,32],[20,43,6,7],[22,0,7,7],[22,6,7,13,"LAST_FETCH"],[22,16,7,23],[22,19,7,26],[22,31,7,7],[25,0,9,7],[25,11,9,16,"fetchCodes"],[25,21,9,7],[25,24,9,29],[26,0,10,4],[26,11,10,11],[26,28,10,18,"dispatch"],[26,36,10,11],[26,38,10,28,"getState"],[26,46,10,11],[27,0,10,11],[28,0,10,11],[29,0,10,11],[30,0,10,11],[31,0,10,11],[32,0,11,8,"dispatch"],[32,14,11,8,"dispatch"],[32,22,11,16],[32,23,11,17,"startCodeFetching"],[32,40,11,34],[32,42,11,16],[32,43,11,8],[33,0,12,14,"state"],[33,14,12,14,"state"],[33,19,10,11],[33,22,12,22,"getState"],[33,30,12,30],[33,32,10,11],[34,0,13,14,"lastFetch"],[34,14,13,14,"lastFetch"],[34,23,10,11],[34,26,13,26,"state"],[34,31,13,31],[34,32,13,32,"codes"],[34,37,13,26],[34,38,13,38,"lastFetch"],[34,47,10,11],[35,0,14,8,"console"],[35,14,14,8,"console"],[35,21,14,15],[35,22,14,16,"log"],[35,25,14,8],[35,26,14,20,"lastFetch"],[35,35,14,8],[37,0,10,11],[37,20,16,11,"lastFetch"],[37,29,16,20],[37,33,16,24,"moment"],[37,49,16,31,"unix"],[37,53,16,24],[37,54,16,36,"lastFetch"],[37,63,16,24],[37,65,16,47,"subtract"],[37,73,16,24],[37,74,16,56],[37,80,16,24],[37,82,16,64],[37,83,16,24],[37,85,16,67,"isAfter"],[37,92,16,24],[37,93,16,75],[37,116,16,84,"subtract"],[37,124,16,75],[37,125,16,93],[37,131,16,75],[37,133,16,101],[37,134,16,75],[37,135,16,24],[37,136,10,11],[38,0,10,11],[39,0,10,11],[40,0,10,11],[42,0,17,12,"dispatch"],[42,14,17,12,"dispatch"],[42,22,17,20],[42,23,17,21,"codeFetchingSuccess"],[42,42,17,40],[42,43,17,41,"state"],[42,48,17,46],[42,49,17,47,"codes"],[42,54,17,41],[42,55,17,53,"codes"],[42,60,17,40],[42,61,17,20],[42,62,17,12],[43,0,10,11],[45,0,10,11],[46,0,21,8,"console"],[46,14,21,8,"console"],[46,21,21,15],[46,22,21,16,"log"],[46,25,21,8],[46,26,21,20],[46,51,21,8],[47,0,10,11],[48,0,25,18,"result"],[48,14,25,18,"result"],[48,20,10,11],[48,23,25,27],[48,25,10,11],[49,0,10,11],[50,0,10,11],[50,48,26,36,"firestore"],[50,68,26,46,"collection"],[50,78,26,36],[50,79,26,57],[50,90,26,36],[50,92,26,70,"limit"],[50,97,26,36],[50,98,26,76],[50,99,26,36],[50,101,26,79,"get"],[50,104,26,36],[50,106,10,11],[52,0,10,11],[53,0,26,18,"companies"],[53,14,26,18,"companies"],[53,23,10,11],[54,0,27,18,"promiseArr"],[54,14,27,18,"promiseArr"],[54,24,10,11],[54,27,27,31],[54,29,10,11],[55,0,29,12,"companies"],[55,14,29,12,"companies"],[55,23,29,21],[55,24,29,22,"forEach"],[55,31,29,12],[55,32,29,30],[55,42,29,30,"company"],[55,49,29,37],[55,51,29,41],[56,0,30,16],[56,20,30,22,"data"],[56,24,30,26],[56,27,30,29,"company"],[56,34,30,36],[56,35,30,37,"data"],[56,39,30,29],[56,41,30,16],[57,0,32,16,"result"],[57,16,32,16,"result"],[57,22,32,22],[57,23,32,23,"push"],[57,27,32,16],[57,28,32,28],[58,0,33,20,"storeName"],[58,18,33,20,"storeName"],[58,27,33,29],[58,29,33,31,"data"],[58,33,33,35],[58,34,33,36,"name"],[58,38,32,28],[59,0,34,20,"logoImage"],[59,18,34,20,"logoImage"],[59,27,34,29],[59,29,34,31,"data"],[59,33,34,35],[59,34,34,36,"logoUrl"],[59,41,32,28],[60,0,35,20,"backgroundImage"],[60,18,35,20,"backgroundImage"],[60,33,35,35],[60,35,35,37,"data"],[60,39,35,41],[60,40,35,42,"backgroundUrl"],[60,53,32,28],[61,0,36,20,"codes"],[61,18,36,20,"codes"],[61,23,36,25],[61,25,36,27],[62,0,32,28],[62,17,32,16],[63,0,39,16,"promiseArr"],[63,16,39,16,"promiseArr"],[63,26,39,26],[63,27,39,27,"push"],[63,31,39,16],[63,32,40,20,"firestore"],[63,52,40,30,"collection"],[63,62,40,20],[63,63,40,41],[63,74,40,20],[63,76,40,54,"doc"],[63,79,40,20],[63,80,40,58,"company"],[63,87,40,65],[63,88,40,66,"id"],[63,90,40,20],[63,92,40,70,"collection"],[63,102,40,20],[63,103,40,81],[63,110,40,20],[63,112,40,90,"get"],[63,115,40,20],[63,117,39,16],[64,0,42,13],[64,15,29,12],[65,0,10,11],[66,0,10,11],[66,48,44,39,"Promise"],[66,55,44,46],[66,56,44,47,"all"],[66,59,44,39],[66,60,44,51,"promiseArr"],[66,70,44,39],[66,71,10,11],[68,0,10,11],[69,0,44,18,"companyCodes"],[69,14,44,18,"companyCodes"],[69,26,10,11],[70,0,46,12,"companyCodes"],[70,14,46,12,"companyCodes"],[70,26,46,24],[70,27,46,25,"forEach"],[70,34,46,12],[70,35,46,33],[70,45,46,34,"item"],[70,49,46,33],[70,51,46,40,"i"],[70,52,46,33],[70,54,46,46],[71,0,48,16],[71,20,48,19],[71,21,48,20,"item"],[71,25,48,24],[71,26,48,25,"empty"],[71,31,48,16],[71,33,48,32],[72,0,49,20,"item"],[72,18,49,20,"item"],[72,22,49,24],[72,23,49,25,"docs"],[72,27,49,20],[72,28,49,30,"forEach"],[72,35,49,20],[72,36,49,38],[72,46,49,38,"code"],[72,50,49,42],[72,52,49,46],[73,0,50,24,"code"],[73,20,50,24,"code"],[73,24,50,28],[73,27,50,31,"code"],[73,31,50,35],[73,32,50,36,"data"],[73,36,50,31],[73,38,50,24],[74,0,51,23],[74,24,51,29,"codeObj"],[74,31,51,36],[74,34,51,39],[75,0,52,27,"name"],[75,22,52,27,"name"],[75,26,52,31],[75,28,52,33,"code"],[75,32,52,37],[75,33,52,38,"name"],[75,37,51,39],[76,0,53,27,"description"],[76,22,53,27,"description"],[76,33,53,38],[76,35,53,40,"code"],[76,39,53,44],[76,40,53,45,"description"],[76,51,51,39],[77,0,54,27,"inStock"],[77,22,54,27,"inStock"],[77,29,54,34],[77,31,54,36,"code"],[77,35,54,40],[77,36,54,41,"currentStock"],[77,48,51,39],[78,0,55,27,"discount"],[78,22,55,27,"discount"],[78,30,55,35],[78,32,55,37,"code"],[78,36,55,41],[78,37,55,42,"discount"],[78,45,51,39],[79,0,56,27,"price"],[79,22,56,27,"price"],[79,27,56,32],[79,29,56,34,"code"],[79,33,56,38],[79,34,56,39,"price"],[80,0,51,39],[80,21,51,23],[81,0,59,23,"result"],[81,20,59,23,"result"],[81,26,59,29],[81,27,59,30,"i"],[81,28,59,29],[81,29,59,23],[81,30,59,33,"codes"],[81,35,59,23],[81,36,59,39,"push"],[81,40,59,23],[81,41,59,44,"codeObj"],[81,48,59,23],[82,0,60,21],[82,19,49,20],[83,0,61,17],[84,0,63,13],[84,15,46,12],[85,0,65,12,"dispatch"],[85,14,65,12,"dispatch"],[85,22,65,20],[85,23,65,21,"codeFetchingSuccess"],[85,42,65,40],[85,43,65,41,"result"],[85,49,65,40],[85,50,65,20],[85,51,65,12],[86,0,66,12,"dispatch"],[86,14,66,12,"dispatch"],[86,22,66,20],[86,23,66,21,"codeLastFetch"],[86,36,66,34],[86,37,66,35,"Math"],[86,41,66,39],[86,42,66,40,"floor"],[86,47,66,35],[86,48,66,46,"Date"],[86,52,66,50],[86,53,66,51,"now"],[86,56,66,46],[86,61,66,59],[86,65,66,35],[86,66,66,34],[86,67,66,20],[86,68,66,12],[87,0,10,11],[88,0,10,11],[90,0,10,11],[91,0,10,11],[92,0,10,11],[93,0,69,12,"dispatch"],[93,14,69,12,"dispatch"],[93,22,69,20],[93,23,69,21,"codeFetchingError"],[93,40,69,38],[93,41,69,39],[93,53,69,45,"message"],[93,60,69,38],[93,61,69,20],[93,62,69,12],[95,0,10,11],[96,0,10,11],[97,0,10,11],[98,0,10,11],[99,0,10,11],[100,0,10,11],[101,0,10,11],[101,5,10,4],[102,0,73,1],[104,0,75,0],[104,11,75,9,"startCodeFetching"],[104,28,75,0],[104,31,75,29],[105,0,76,4],[105,11,76,11],[106,0,77,8,"type"],[106,6,77,8,"type"],[106,10,77,12],[106,12,77,14,"FETCH_CODES_START"],[107,0,76,11],[107,5,76,4],[108,0,79,1],[110,0,81,0],[110,11,81,9,"codeFetchingSuccess"],[110,30,81,0],[110,31,81,29,"codes"],[110,36,81,0],[110,38,81,36],[111,0,82,4],[111,11,82,11],[112,0,83,8,"type"],[112,6,83,8,"type"],[112,10,83,12],[112,12,83,14,"FETCH_CODE_SUCCESS"],[112,30,82,11],[113,0,84,8,"codes"],[113,6,84,8,"codes"],[113,11,84,13],[113,13,84,8,"codes"],[114,0,82,11],[114,5,82,4],[115,0,86,1],[117,0,88,0],[117,11,88,9,"codeFetchingError"],[117,28,88,0],[117,29,88,27,"error"],[117,34,88,0],[117,36,88,34],[118,0,89,4],[118,11,89,11],[119,0,90,8,"type"],[119,6,90,8,"type"],[119,10,90,12],[119,12,90,14,"FETCH_CODE_ERROR"],[119,28,89,11],[120,0,91,8,"error"],[120,6,91,8,"error"],[120,11,91,13],[120,13,91,8,"error"],[121,0,89,11],[121,5,89,4],[122,0,93,1],[124,0,95,0],[124,11,95,9,"codeLastFetch"],[124,24,95,0],[124,25,95,23,"lastFetch"],[124,34,95,0],[124,36,95,34],[125,0,96,4],[125,11,96,11],[126,0,97,8,"type"],[126,6,97,8,"type"],[126,10,97,12],[126,12,97,14,"LAST_FETCH"],[126,22,96,11],[127,0,98,8,"lastFetch"],[127,6,98,8,"lastFetch"],[127,15,98,17],[127,17,98,8,"lastFetch"],[128,0,96,11],[128,5,96,4],[129,0,100,1]]},"type":"js/module"}]}