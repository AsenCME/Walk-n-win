{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/regenerator","data":{"isAsync":false}},{"name":"moment","data":{"isAsync":false}},{"name":"../../firebase","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.fetchCodes = fetchCodes;\n  exports.LAST_FETCH = exports.FETCH_CODE_ERROR = exports.FETCH_CODE_SUCCESS = exports.FETCH_CODES_START = void 0;\n\n  var _regenerator = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/regenerator\"));\n\n  var _moment = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"moment\"));\n\n  var _firebase = _$$_REQUIRE(_dependencyMap[3], \"../../firebase\");\n\n  var FETCH_CODES_START = 'FETCH_CODES_START';\n  exports.FETCH_CODES_START = FETCH_CODES_START;\n  var FETCH_CODE_SUCCESS = 'FETCH_CODE_SUCCESS';\n  exports.FETCH_CODE_SUCCESS = FETCH_CODE_SUCCESS;\n  var FETCH_CODE_ERROR = 'FETCH_CODE_ERROR';\n  exports.FETCH_CODE_ERROR = FETCH_CODE_ERROR;\n  var LAST_FETCH = 'LAST_FETCH';\n  exports.LAST_FETCH = LAST_FETCH;\n\n  function fetchCodes() {\n    return function _callee(dispatch, getState) {\n      var state, lastFetch, result, companies, promiseArr, companyCodes;\n      return _regenerator.default.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch(startCodeFetching());\n              state = getState();\n              lastFetch = state.codes.lastFetch;\n              console.log(lastFetch);\n\n              if (!(lastFetch && _moment.default.unix(lastFetch).subtract('hour', 1).isAfter((0, _moment.default)().subtract('hour', 1)))) {\n                _context.next = 7;\n                break;\n              }\n\n              dispatch(codeFetchingSuccess(state.codes.codes));\n              return _context.abrupt(\"return\");\n\n            case 7:\n              _context.prev = 7;\n              result = [];\n              _context.next = 11;\n              return _regenerator.default.awrap(_firebase.firestore.collection('companies').limit(5).get());\n\n            case 11:\n              companies = _context.sent;\n              promiseArr = [];\n              companies.forEach(function (company) {\n                var data = company.data();\n                result.push({\n                  storeName: data.name,\n                  logoImage: data.logoUrl,\n                  backgroundImage: data.backgroundUrl,\n                  codes: []\n                });\n                promiseArr.push(_firebase.firestore.collection('companies').doc(company.id).collection('codes').get());\n              });\n              _context.next = 16;\n              return _regenerator.default.awrap(Promise.all(promiseArr));\n\n            case 16:\n              companyCodes = _context.sent;\n              companyCodes.forEach(function (item, i) {\n                if (!item.empty) {\n                  item.docs.forEach(function (code) {\n                    code = code.data();\n                    var codeObj = {\n                      name: code.name,\n                      description: code.description,\n                      inStock: code.currentStock,\n                      discount: code.discount,\n                      price: code.price\n                    };\n                    result[i].codes.push(codeObj);\n                  });\n                }\n              });\n              dispatch(codeFetchingSuccess(result));\n              dispatch(codeLastFetch(Math.floor(Date.now() / 1000)));\n              _context.next = 25;\n              break;\n\n            case 22:\n              _context.prev = 22;\n              _context.t0 = _context[\"catch\"](7);\n              dispatch(codeFetchingError(_context.t0.message));\n\n            case 25:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[7, 22]]);\n    };\n  }\n\n  function startCodeFetching() {\n    return {\n      type: FETCH_CODES_START\n    };\n  }\n\n  function codeFetchingSuccess(codes) {\n    return {\n      type: FETCH_CODE_SUCCESS,\n      codes: codes\n    };\n  }\n\n  function codeFetchingError(error) {\n    return {\n      type: FETCH_CODE_ERROR,\n      error: error\n    };\n  }\n\n  function codeLastFetch(lastFetch) {\n    return {\n      type: LAST_FETCH,\n      lastFetch: lastFetch\n    };\n  }\n});","map":[[12,0,1,0],[14,0,2,0],[16,0,4,7],[16,6,4,13,"FETCH_CODES_START"],[16,23,4,30],[16,26,4,33],[16,45,4,7],[18,0,5,7],[18,6,5,13,"FETCH_CODE_SUCCESS"],[18,24,5,31],[18,27,5,34],[18,47,5,7],[20,0,6,7],[20,6,6,13,"FETCH_CODE_ERROR"],[20,22,6,29],[20,25,6,32],[20,43,6,7],[22,0,7,7],[22,6,7,13,"LAST_FETCH"],[22,16,7,23],[22,19,7,26],[22,31,7,7],[25,0,9,7],[25,11,9,16,"fetchCodes"],[25,21,9,7],[25,24,9,29],[26,0,10,4],[26,11,10,11],[26,28,10,18,"dispatch"],[26,36,10,11],[26,38,10,28,"getState"],[26,46,10,11],[27,0,10,11],[28,0,10,11],[29,0,10,11],[30,0,10,11],[31,0,10,11],[32,0,11,8,"dispatch"],[32,14,11,8,"dispatch"],[32,22,11,16],[32,23,11,17,"startCodeFetching"],[32,40,11,34],[32,42,11,16],[32,43,11,8],[33,0,12,14,"state"],[33,14,12,14,"state"],[33,19,10,11],[33,22,12,22,"getState"],[33,30,12,30],[33,32,10,11],[34,0,13,14,"lastFetch"],[34,14,13,14,"lastFetch"],[34,23,10,11],[34,26,13,26,"state"],[34,31,13,31],[34,32,13,32,"codes"],[34,37,13,26],[34,38,13,38,"lastFetch"],[34,47,10,11],[35,0,14,8,"console"],[35,14,14,8,"console"],[35,21,14,15],[35,22,14,16,"log"],[35,25,14,8],[35,26,14,20,"lastFetch"],[35,35,14,8],[37,0,10,11],[37,20,16,11,"lastFetch"],[37,29,16,20],[37,33,16,24,"moment"],[37,49,16,31,"unix"],[37,53,16,24],[37,54,16,36,"lastFetch"],[37,63,16,24],[37,65,16,47,"subtract"],[37,73,16,24],[37,74,16,56],[37,80,16,24],[37,82,16,64],[37,83,16,24],[37,85,16,67,"isAfter"],[37,92,16,24],[37,93,16,75],[37,116,16,84,"subtract"],[37,124,16,75],[37,125,16,93],[37,131,16,75],[37,133,16,101],[37,134,16,75],[37,135,16,24],[37,136,10,11],[38,0,10,11],[39,0,10,11],[40,0,10,11],[42,0,17,12,"dispatch"],[42,14,17,12,"dispatch"],[42,22,17,20],[42,23,17,21,"codeFetchingSuccess"],[42,42,17,40],[42,43,17,41,"state"],[42,48,17,46],[42,49,17,47,"codes"],[42,54,17,41],[42,55,17,53,"codes"],[42,60,17,40],[42,61,17,20],[42,62,17,12],[43,0,10,11],[45,0,10,11],[46,0,10,11],[47,0,23,18,"result"],[47,14,23,18,"result"],[47,20,10,11],[47,23,23,27],[47,25,10,11],[48,0,10,11],[49,0,10,11],[49,48,24,36,"firestore"],[49,68,24,46,"collection"],[49,78,24,36],[49,79,24,57],[49,90,24,36],[49,92,24,70,"limit"],[49,97,24,36],[49,98,24,76],[49,99,24,36],[49,101,24,79,"get"],[49,104,24,36],[49,106,10,11],[51,0,10,11],[52,0,24,18,"companies"],[52,14,24,18,"companies"],[52,23,10,11],[53,0,25,18,"promiseArr"],[53,14,25,18,"promiseArr"],[53,24,10,11],[53,27,25,31],[53,29,10,11],[54,0,27,12,"companies"],[54,14,27,12,"companies"],[54,23,27,21],[54,24,27,22,"forEach"],[54,31,27,12],[54,32,27,30],[54,42,27,30,"company"],[54,49,27,37],[54,51,27,41],[55,0,28,16],[55,20,28,22,"data"],[55,24,28,26],[55,27,28,29,"company"],[55,34,28,36],[55,35,28,37,"data"],[55,39,28,29],[55,41,28,16],[56,0,30,16,"result"],[56,16,30,16,"result"],[56,22,30,22],[56,23,30,23,"push"],[56,27,30,16],[56,28,30,28],[57,0,31,20,"storeName"],[57,18,31,20,"storeName"],[57,27,31,29],[57,29,31,31,"data"],[57,33,31,35],[57,34,31,36,"name"],[57,38,30,28],[58,0,32,20,"logoImage"],[58,18,32,20,"logoImage"],[58,27,32,29],[58,29,32,31,"data"],[58,33,32,35],[58,34,32,36,"logoUrl"],[58,41,30,28],[59,0,33,20,"backgroundImage"],[59,18,33,20,"backgroundImage"],[59,33,33,35],[59,35,33,37,"data"],[59,39,33,41],[59,40,33,42,"backgroundUrl"],[59,53,30,28],[60,0,34,20,"codes"],[60,18,34,20,"codes"],[60,23,34,25],[60,25,34,27],[61,0,30,28],[61,17,30,16],[62,0,37,16,"promiseArr"],[62,16,37,16,"promiseArr"],[62,26,37,26],[62,27,37,27,"push"],[62,31,37,16],[62,32,38,20,"firestore"],[62,52,38,30,"collection"],[62,62,38,20],[62,63,38,41],[62,74,38,20],[62,76,38,54,"doc"],[62,79,38,20],[62,80,38,58,"company"],[62,87,38,65],[62,88,38,66,"id"],[62,90,38,20],[62,92,38,70,"collection"],[62,102,38,20],[62,103,38,81],[62,110,38,20],[62,112,38,90,"get"],[62,115,38,20],[62,117,37,16],[63,0,40,13],[63,15,27,12],[64,0,10,11],[65,0,10,11],[65,48,42,39,"Promise"],[65,55,42,46],[65,56,42,47,"all"],[65,59,42,39],[65,60,42,51,"promiseArr"],[65,70,42,39],[65,71,10,11],[67,0,10,11],[68,0,42,18,"companyCodes"],[68,14,42,18,"companyCodes"],[68,26,10,11],[69,0,44,12,"companyCodes"],[69,14,44,12,"companyCodes"],[69,26,44,24],[69,27,44,25,"forEach"],[69,34,44,12],[69,35,44,33],[69,45,44,34,"item"],[69,49,44,33],[69,51,44,40,"i"],[69,52,44,33],[69,54,44,46],[70,0,46,16],[70,20,46,19],[70,21,46,20,"item"],[70,25,46,24],[70,26,46,25,"empty"],[70,31,46,16],[70,33,46,32],[71,0,47,20,"item"],[71,18,47,20,"item"],[71,22,47,24],[71,23,47,25,"docs"],[71,27,47,20],[71,28,47,30,"forEach"],[71,35,47,20],[71,36,47,38],[71,46,47,38,"code"],[71,50,47,42],[71,52,47,46],[72,0,48,24,"code"],[72,20,48,24,"code"],[72,24,48,28],[72,27,48,31,"code"],[72,31,48,35],[72,32,48,36,"data"],[72,36,48,31],[72,38,48,24],[73,0,49,23],[73,24,49,29,"codeObj"],[73,31,49,36],[73,34,49,39],[74,0,50,27,"name"],[74,22,50,27,"name"],[74,26,50,31],[74,28,50,33,"code"],[74,32,50,37],[74,33,50,38,"name"],[74,37,49,39],[75,0,51,27,"description"],[75,22,51,27,"description"],[75,33,51,38],[75,35,51,40,"code"],[75,39,51,44],[75,40,51,45,"description"],[75,51,49,39],[76,0,52,27,"inStock"],[76,22,52,27,"inStock"],[76,29,52,34],[76,31,52,36,"code"],[76,35,52,40],[76,36,52,41,"currentStock"],[76,48,49,39],[77,0,53,27,"discount"],[77,22,53,27,"discount"],[77,30,53,35],[77,32,53,37,"code"],[77,36,53,41],[77,37,53,42,"discount"],[77,45,49,39],[78,0,54,27,"price"],[78,22,54,27,"price"],[78,27,54,32],[78,29,54,34,"code"],[78,33,54,38],[78,34,54,39,"price"],[79,0,49,39],[79,21,49,23],[80,0,57,23,"result"],[80,20,57,23,"result"],[80,26,57,29],[80,27,57,30,"i"],[80,28,57,29],[80,29,57,23],[80,30,57,33,"codes"],[80,35,57,23],[80,36,57,39,"push"],[80,40,57,23],[80,41,57,44,"codeObj"],[80,48,57,23],[81,0,58,21],[81,19,47,20],[82,0,59,17],[83,0,61,13],[83,15,44,12],[84,0,63,12,"dispatch"],[84,14,63,12,"dispatch"],[84,22,63,20],[84,23,63,21,"codeFetchingSuccess"],[84,42,63,40],[84,43,63,41,"result"],[84,49,63,40],[84,50,63,20],[84,51,63,12],[85,0,64,12,"dispatch"],[85,14,64,12,"dispatch"],[85,22,64,20],[85,23,64,21,"codeLastFetch"],[85,36,64,34],[85,37,64,35,"Math"],[85,41,64,39],[85,42,64,40,"floor"],[85,47,64,35],[85,48,64,46,"Date"],[85,52,64,50],[85,53,64,51,"now"],[85,56,64,46],[85,61,64,59],[85,65,64,35],[85,66,64,34],[85,67,64,20],[85,68,64,12],[86,0,10,11],[87,0,10,11],[89,0,10,11],[90,0,10,11],[91,0,10,11],[92,0,67,12,"dispatch"],[92,14,67,12,"dispatch"],[92,22,67,20],[92,23,67,21,"codeFetchingError"],[92,40,67,38],[92,41,67,39],[92,53,67,45,"message"],[92,60,67,38],[92,61,67,20],[92,62,67,12],[94,0,10,11],[95,0,10,11],[96,0,10,11],[97,0,10,11],[98,0,10,11],[99,0,10,11],[100,0,10,11],[100,5,10,4],[101,0,71,1],[103,0,73,0],[103,11,73,9,"startCodeFetching"],[103,28,73,0],[103,31,73,29],[104,0,74,4],[104,11,74,11],[105,0,75,8,"type"],[105,6,75,8,"type"],[105,10,75,12],[105,12,75,14,"FETCH_CODES_START"],[106,0,74,11],[106,5,74,4],[107,0,77,1],[109,0,79,0],[109,11,79,9,"codeFetchingSuccess"],[109,30,79,0],[109,31,79,29,"codes"],[109,36,79,0],[109,38,79,36],[110,0,80,4],[110,11,80,11],[111,0,81,8,"type"],[111,6,81,8,"type"],[111,10,81,12],[111,12,81,14,"FETCH_CODE_SUCCESS"],[111,30,80,11],[112,0,82,8,"codes"],[112,6,82,8,"codes"],[112,11,82,13],[112,13,82,8,"codes"],[113,0,80,11],[113,5,80,4],[114,0,84,1],[116,0,86,0],[116,11,86,9,"codeFetchingError"],[116,28,86,0],[116,29,86,27,"error"],[116,34,86,0],[116,36,86,34],[117,0,87,4],[117,11,87,11],[118,0,88,8,"type"],[118,6,88,8,"type"],[118,10,88,12],[118,12,88,14,"FETCH_CODE_ERROR"],[118,28,87,11],[119,0,89,8,"error"],[119,6,89,8,"error"],[119,11,89,13],[119,13,89,8,"error"],[120,0,87,11],[120,5,87,4],[121,0,91,1],[123,0,93,0],[123,11,93,9,"codeLastFetch"],[123,24,93,0],[123,25,93,23,"lastFetch"],[123,34,93,0],[123,36,93,34],[124,0,94,4],[124,11,94,11],[125,0,95,8,"type"],[125,6,95,8,"type"],[125,10,95,12],[125,12,95,14,"LAST_FETCH"],[125,22,94,11],[126,0,96,8,"lastFetch"],[126,6,96,8,"lastFetch"],[126,15,96,17],[126,17,96,8,"lastFetch"],[127,0,94,11],[127,5,94,4],[128,0,98,1]]},"type":"js/module"}]}