{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/regenerator","data":{"isAsync":false}},{"name":"moment","data":{"isAsync":false}},{"name":"../../firebase","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.fetchCodes = fetchCodes;\n  exports.selectCompany = selectCompany;\n  exports.SELECT_COMPANY = exports.LAST_FETCH = exports.FETCH_CODE_ERROR = exports.FETCH_CODE_SUCCESS = exports.FETCH_CODES_START = void 0;\n\n  var _regenerator = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/regenerator\"));\n\n  var _moment = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"moment\"));\n\n  var _firebase = _$$_REQUIRE(_dependencyMap[3], \"../../firebase\");\n\n  var FETCH_CODES_START = 'FETCH_CODES_START';\n  exports.FETCH_CODES_START = FETCH_CODES_START;\n  var FETCH_CODE_SUCCESS = 'FETCH_CODE_SUCCESS';\n  exports.FETCH_CODE_SUCCESS = FETCH_CODE_SUCCESS;\n  var FETCH_CODE_ERROR = 'FETCH_CODE_ERROR';\n  exports.FETCH_CODE_ERROR = FETCH_CODE_ERROR;\n  var LAST_FETCH = 'LAST_FETCH';\n  exports.LAST_FETCH = LAST_FETCH;\n  var SELECT_COMPANY = 'SELECT_COMPANY';\n  exports.SELECT_COMPANY = SELECT_COMPANY;\n\n  function fetchCodes() {\n    return function _callee(dispatch, getState) {\n      var state, lastFetch, result, companies, promiseArr, companyCodes;\n      return _regenerator.default.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch(startCodeFetching());\n              state = getState();\n              lastFetch = state.codes.lastFetch;\n\n              if (!(lastFetch && _moment.default.unix(lastFetch).isAfter((0, _moment.default)().subtract(1, 'hour')))) {\n                _context.next = 6;\n                break;\n              }\n\n              dispatch(codeFetchingSuccess(state.codes.codes));\n              return _context.abrupt(\"return\");\n\n            case 6:\n              _context.prev = 6;\n              result = [];\n              _context.next = 10;\n              return _regenerator.default.awrap(_firebase.firestore.collection('companies').limit(5).get());\n\n            case 10:\n              companies = _context.sent;\n              promiseArr = [];\n              companies.forEach(function (company) {\n                var data = company.data();\n                result.push({\n                  storeName: data.name,\n                  logoImage: data.logoUrl,\n                  backgroundImage: data.backgroundUrl,\n                  codes: []\n                });\n                promiseArr.push(_firebase.firestore.collection('companies').doc(company.id).collection('codes').get());\n              });\n              _context.next = 15;\n              return _regenerator.default.awrap(Promise.all(promiseArr));\n\n            case 15:\n              companyCodes = _context.sent;\n              companyCodes.forEach(function (item, i) {\n                if (!item.empty) {\n                  item.docs.forEach(function (code) {\n                    code = code.data();\n                    var codeObj = {\n                      name: code.name,\n                      description: code.description,\n                      inStock: code.currentStock,\n                      discount: code.discount,\n                      price: code.price,\n                      codeVariations: code.codes\n                    };\n                    result[i].codes.push(codeObj);\n                  });\n                }\n              });\n              dispatch(codeFetchingSuccess(result));\n              dispatch(codeLastFetch(Math.floor(Date.now() / 1000)));\n              _context.next = 24;\n              break;\n\n            case 21:\n              _context.prev = 21;\n              _context.t0 = _context[\"catch\"](6);\n              dispatch(codeFetchingError(_context.t0.message));\n\n            case 24:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[6, 21]]);\n    };\n  }\n\n  function startCodeFetching() {\n    return {\n      type: FETCH_CODES_START\n    };\n  }\n\n  function codeFetchingSuccess(codes) {\n    return {\n      type: FETCH_CODE_SUCCESS,\n      codes: codes\n    };\n  }\n\n  function codeFetchingError(error) {\n    return {\n      type: FETCH_CODE_ERROR,\n      error: error\n    };\n  }\n\n  function codeLastFetch(lastFetch) {\n    return {\n      type: LAST_FETCH,\n      lastFetch: lastFetch\n    };\n  }\n\n  function selectCompany(index) {\n    return {\n      type: SELECT_COMPANY,\n      index: index\n    };\n  }\n});","map":[[13,0,1,0],[15,0,2,0],[17,0,4,7],[17,6,4,13,"FETCH_CODES_START"],[17,23,4,30],[17,26,4,33],[17,45,4,7],[19,0,5,7],[19,6,5,13,"FETCH_CODE_SUCCESS"],[19,24,5,31],[19,27,5,34],[19,47,5,7],[21,0,6,7],[21,6,6,13,"FETCH_CODE_ERROR"],[21,22,6,29],[21,25,6,32],[21,43,6,7],[23,0,7,7],[23,6,7,13,"LAST_FETCH"],[23,16,7,23],[23,19,7,26],[23,31,7,7],[25,0,8,7],[25,6,8,13,"SELECT_COMPANY"],[25,20,8,27],[25,23,8,30],[25,39,8,7],[28,0,10,7],[28,11,10,16,"fetchCodes"],[28,21,10,7],[28,24,10,29],[29,0,11,4],[29,11,11,11],[29,28,11,18,"dispatch"],[29,36,11,11],[29,38,11,28,"getState"],[29,46,11,11],[30,0,11,11],[31,0,11,11],[32,0,11,11],[33,0,11,11],[34,0,11,11],[35,0,12,8,"dispatch"],[35,14,12,8,"dispatch"],[35,22,12,16],[35,23,12,17,"startCodeFetching"],[35,40,12,34],[35,42,12,16],[35,43,12,8],[36,0,13,14,"state"],[36,14,13,14,"state"],[36,19,11,11],[36,22,13,22,"getState"],[36,30,13,30],[36,32,11,11],[37,0,14,14,"lastFetch"],[37,14,14,14,"lastFetch"],[37,23,11,11],[37,26,14,26,"state"],[37,31,14,31],[37,32,14,32,"codes"],[37,37,14,26],[37,38,14,38,"lastFetch"],[37,47,11,11],[39,0,11,11],[39,20,17,11,"lastFetch"],[39,29,17,20],[39,33,17,24,"moment"],[39,49,17,31,"unix"],[39,53,17,24],[39,54,17,36,"lastFetch"],[39,63,17,24],[39,65,17,47,"isAfter"],[39,72,17,24],[39,73,17,55],[39,96,17,64,"subtract"],[39,104,17,55],[39,105,17,73],[39,106,17,55],[39,108,17,76],[39,114,17,55],[39,115,17,24],[39,116,11,11],[40,0,11,11],[41,0,11,11],[42,0,11,11],[44,0,18,12,"dispatch"],[44,14,18,12,"dispatch"],[44,22,18,20],[44,23,18,21,"codeFetchingSuccess"],[44,42,18,40],[44,43,18,41,"state"],[44,48,18,46],[44,49,18,47,"codes"],[44,54,18,41],[44,55,18,53,"codes"],[44,60,18,40],[44,61,18,20],[44,62,18,12],[45,0,11,11],[47,0,11,11],[48,0,11,11],[49,0,23,18,"result"],[49,14,23,18,"result"],[49,20,11,11],[49,23,23,27],[49,25,11,11],[50,0,11,11],[51,0,11,11],[51,48,24,36,"firestore"],[51,68,24,46,"collection"],[51,78,24,36],[51,79,24,57],[51,90,24,36],[51,92,24,70,"limit"],[51,97,24,36],[51,98,24,76],[51,99,24,36],[51,101,24,79,"get"],[51,104,24,36],[51,106,11,11],[53,0,11,11],[54,0,24,18,"companies"],[54,14,24,18,"companies"],[54,23,11,11],[55,0,25,18,"promiseArr"],[55,14,25,18,"promiseArr"],[55,24,11,11],[55,27,25,31],[55,29,11,11],[56,0,27,12,"companies"],[56,14,27,12,"companies"],[56,23,27,21],[56,24,27,22,"forEach"],[56,31,27,12],[56,32,27,30],[56,42,27,30,"company"],[56,49,27,37],[56,51,27,41],[57,0,28,16],[57,20,28,22,"data"],[57,24,28,26],[57,27,28,29,"company"],[57,34,28,36],[57,35,28,37,"data"],[57,39,28,29],[57,41,28,16],[58,0,30,16,"result"],[58,16,30,16,"result"],[58,22,30,22],[58,23,30,23,"push"],[58,27,30,16],[58,28,30,28],[59,0,31,20,"storeName"],[59,18,31,20,"storeName"],[59,27,31,29],[59,29,31,31,"data"],[59,33,31,35],[59,34,31,36,"name"],[59,38,30,28],[60,0,32,20,"logoImage"],[60,18,32,20,"logoImage"],[60,27,32,29],[60,29,32,31,"data"],[60,33,32,35],[60,34,32,36,"logoUrl"],[60,41,30,28],[61,0,33,20,"backgroundImage"],[61,18,33,20,"backgroundImage"],[61,33,33,35],[61,35,33,37,"data"],[61,39,33,41],[61,40,33,42,"backgroundUrl"],[61,53,30,28],[62,0,34,20,"codes"],[62,18,34,20,"codes"],[62,23,34,25],[62,25,34,27],[63,0,30,28],[63,17,30,16],[64,0,37,16,"promiseArr"],[64,16,37,16,"promiseArr"],[64,26,37,26],[64,27,37,27,"push"],[64,31,37,16],[64,32,38,20,"firestore"],[64,52,38,30,"collection"],[64,62,38,20],[64,63,38,41],[64,74,38,20],[64,76,38,54,"doc"],[64,79,38,20],[64,80,38,58,"company"],[64,87,38,65],[64,88,38,66,"id"],[64,90,38,20],[64,92,38,70,"collection"],[64,102,38,20],[64,103,38,81],[64,110,38,20],[64,112,38,90,"get"],[64,115,38,20],[64,117,37,16],[65,0,40,13],[65,15,27,12],[66,0,11,11],[67,0,11,11],[67,48,42,39,"Promise"],[67,55,42,46],[67,56,42,47,"all"],[67,59,42,39],[67,60,42,51,"promiseArr"],[67,70,42,39],[67,71,11,11],[69,0,11,11],[70,0,42,18,"companyCodes"],[70,14,42,18,"companyCodes"],[70,26,11,11],[71,0,44,12,"companyCodes"],[71,14,44,12,"companyCodes"],[71,26,44,24],[71,27,44,25,"forEach"],[71,34,44,12],[71,35,44,33],[71,45,44,34,"item"],[71,49,44,33],[71,51,44,40,"i"],[71,52,44,33],[71,54,44,46],[72,0,46,16],[72,20,46,19],[72,21,46,20,"item"],[72,25,46,24],[72,26,46,25,"empty"],[72,31,46,16],[72,33,46,32],[73,0,47,20,"item"],[73,18,47,20,"item"],[73,22,47,24],[73,23,47,25,"docs"],[73,27,47,20],[73,28,47,30,"forEach"],[73,35,47,20],[73,36,47,38],[73,46,47,38,"code"],[73,50,47,42],[73,52,47,46],[74,0,48,24,"code"],[74,20,48,24,"code"],[74,24,48,28],[74,27,48,31,"code"],[74,31,48,35],[74,32,48,36,"data"],[74,36,48,31],[74,38,48,24],[75,0,49,23],[75,24,49,29,"codeObj"],[75,31,49,36],[75,34,49,39],[76,0,50,27,"name"],[76,22,50,27,"name"],[76,26,50,31],[76,28,50,33,"code"],[76,32,50,37],[76,33,50,38,"name"],[76,37,49,39],[77,0,51,27,"description"],[77,22,51,27,"description"],[77,33,51,38],[77,35,51,40,"code"],[77,39,51,44],[77,40,51,45,"description"],[77,51,49,39],[78,0,52,27,"inStock"],[78,22,52,27,"inStock"],[78,29,52,34],[78,31,52,36,"code"],[78,35,52,40],[78,36,52,41,"currentStock"],[78,48,49,39],[79,0,53,27,"discount"],[79,22,53,27,"discount"],[79,30,53,35],[79,32,53,37,"code"],[79,36,53,41],[79,37,53,42,"discount"],[79,45,49,39],[80,0,54,27,"price"],[80,22,54,27,"price"],[80,27,54,32],[80,29,54,34,"code"],[80,33,54,38],[80,34,54,39,"price"],[80,39,49,39],[81,0,55,27,"codeVariations"],[81,22,55,27,"codeVariations"],[81,36,55,41],[81,38,55,43,"code"],[81,42,55,47],[81,43,55,48,"codes"],[82,0,49,39],[82,21,49,23],[83,0,58,23,"result"],[83,20,58,23,"result"],[83,26,58,29],[83,27,58,30,"i"],[83,28,58,29],[83,29,58,23],[83,30,58,33,"codes"],[83,35,58,23],[83,36,58,39,"push"],[83,40,58,23],[83,41,58,44,"codeObj"],[83,48,58,23],[84,0,59,21],[84,19,47,20],[85,0,60,17],[86,0,62,13],[86,15,44,12],[87,0,64,12,"dispatch"],[87,14,64,12,"dispatch"],[87,22,64,20],[87,23,64,21,"codeFetchingSuccess"],[87,42,64,40],[87,43,64,41,"result"],[87,49,64,40],[87,50,64,20],[87,51,64,12],[88,0,65,12,"dispatch"],[88,14,65,12,"dispatch"],[88,22,65,20],[88,23,65,21,"codeLastFetch"],[88,36,65,34],[88,37,65,35,"Math"],[88,41,65,39],[88,42,65,40,"floor"],[88,47,65,35],[88,48,65,46,"Date"],[88,52,65,50],[88,53,65,51,"now"],[88,56,65,46],[88,61,65,59],[88,65,65,35],[88,66,65,34],[88,67,65,20],[88,68,65,12],[89,0,11,11],[90,0,11,11],[92,0,11,11],[93,0,11,11],[94,0,11,11],[95,0,68,12,"dispatch"],[95,14,68,12,"dispatch"],[95,22,68,20],[95,23,68,21,"codeFetchingError"],[95,40,68,38],[95,41,68,39],[95,53,68,45,"message"],[95,60,68,38],[95,61,68,20],[95,62,68,12],[97,0,11,11],[98,0,11,11],[99,0,11,11],[100,0,11,11],[101,0,11,11],[102,0,11,11],[103,0,11,11],[103,5,11,4],[104,0,72,1],[106,0,74,0],[106,11,74,9,"startCodeFetching"],[106,28,74,0],[106,31,74,29],[107,0,75,4],[107,11,75,11],[108,0,76,8,"type"],[108,6,76,8,"type"],[108,10,76,12],[108,12,76,14,"FETCH_CODES_START"],[109,0,75,11],[109,5,75,4],[110,0,78,1],[112,0,80,0],[112,11,80,9,"codeFetchingSuccess"],[112,30,80,0],[112,31,80,29,"codes"],[112,36,80,0],[112,38,80,36],[113,0,81,4],[113,11,81,11],[114,0,82,8,"type"],[114,6,82,8,"type"],[114,10,82,12],[114,12,82,14,"FETCH_CODE_SUCCESS"],[114,30,81,11],[115,0,83,8,"codes"],[115,6,83,8,"codes"],[115,11,83,13],[115,13,83,8,"codes"],[116,0,81,11],[116,5,81,4],[117,0,85,1],[119,0,87,0],[119,11,87,9,"codeFetchingError"],[119,28,87,0],[119,29,87,27,"error"],[119,34,87,0],[119,36,87,34],[120,0,88,4],[120,11,88,11],[121,0,89,8,"type"],[121,6,89,8,"type"],[121,10,89,12],[121,12,89,14,"FETCH_CODE_ERROR"],[121,28,88,11],[122,0,90,8,"error"],[122,6,90,8,"error"],[122,11,90,13],[122,13,90,8,"error"],[123,0,88,11],[123,5,88,4],[124,0,92,1],[126,0,94,0],[126,11,94,9,"codeLastFetch"],[126,24,94,0],[126,25,94,23,"lastFetch"],[126,34,94,0],[126,36,94,34],[127,0,95,4],[127,11,95,11],[128,0,96,8,"type"],[128,6,96,8,"type"],[128,10,96,12],[128,12,96,14,"LAST_FETCH"],[128,22,95,11],[129,0,97,8,"lastFetch"],[129,6,97,8,"lastFetch"],[129,15,97,17],[129,17,97,8,"lastFetch"],[130,0,95,11],[130,5,95,4],[131,0,99,1],[133,0,101,7],[133,11,101,16,"selectCompany"],[133,24,101,7],[133,25,101,30,"index"],[133,30,101,7],[133,32,101,37],[134,0,102,4],[134,11,102,11],[135,0,103,8,"type"],[135,6,103,8,"type"],[135,10,103,12],[135,12,103,14,"SELECT_COMPANY"],[135,26,102,11],[136,0,104,8,"index"],[136,6,104,8,"index"],[136,11,104,13],[136,13,104,8,"index"],[137,0,102,11],[137,5,102,4],[138,0,106,1]]},"type":"js/module"}]}