{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/regenerator","data":{"isAsync":false}},{"name":"moment","data":{"isAsync":false}},{"name":"../../firebase","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.fetchCodes = fetchCodes;\n  exports.LAST_FETCH = exports.FETCH_CODE_ERROR = exports.FETCH_CODE_SUCCESS = exports.FETCH_CODES_START = void 0;\n\n  var _regenerator = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/regenerator\"));\n\n  var _moment = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"moment\"));\n\n  var _firebase = _$$_REQUIRE(_dependencyMap[3], \"../../firebase\");\n\n  var FETCH_CODES_START = 'FETCH_CODES_START';\n  exports.FETCH_CODES_START = FETCH_CODES_START;\n  var FETCH_CODE_SUCCESS = 'FETCH_CODE_SUCCESS';\n  exports.FETCH_CODE_SUCCESS = FETCH_CODE_SUCCESS;\n  var FETCH_CODE_ERROR = 'FETCH_CODE_ERROR';\n  exports.FETCH_CODE_ERROR = FETCH_CODE_ERROR;\n  var LAST_FETCH = 'LAST_FETCH';\n  exports.LAST_FETCH = LAST_FETCH;\n\n  function fetchCodes() {\n    return function _callee(dispatch, getState) {\n      var state, lastFetch, result, companies, promiseArr, companyCodes;\n      return _regenerator.default.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch(startCodeFetching());\n              state = getState();\n              lastFetch = state.codes.lastFetch;\n              console.log(lastFetch);\n\n              if (!(lastFetch && _moment.default.unix(lastFetch).isAfter((0, _moment.default)().subtract(1, 'hour')))) {\n                _context.next = 7;\n                break;\n              }\n\n              dispatch(codeFetchingSuccess(state.codes.codes));\n              return _context.abrupt(\"return\");\n\n            case 7:\n              _context.prev = 7;\n              result = [];\n              _context.next = 11;\n              return _regenerator.default.awrap(_firebase.firestore.collection('companies').limit(5).get());\n\n            case 11:\n              companies = _context.sent;\n              promiseArr = [];\n              companies.forEach(function (company) {\n                var data = company.data();\n                result.push({\n                  storeName: data.name,\n                  logoImage: data.logoUrl,\n                  backgroundImage: data.backgroundUrl,\n                  codes: []\n                });\n                promiseArr.push(_firebase.firestore.collection('companies').doc(company.id).collection('codes').get());\n              });\n              _context.next = 16;\n              return _regenerator.default.awrap(Promise.all(promiseArr));\n\n            case 16:\n              companyCodes = _context.sent;\n              companyCodes.forEach(function (item, i) {\n                if (!item.empty) {\n                  item.docs.forEach(function (code) {\n                    code = code.data();\n                    var codeObj = {\n                      name: code.name,\n                      description: code.description,\n                      inStock: code.currentStock,\n                      discount: code.discount,\n                      price: code.price\n                    };\n                    result[i].codes.push(codeObj);\n                  });\n                }\n              });\n              dispatch(codeFetchingSuccess(result));\n              dispatch(codeLastFetch(Math.floor(Date.now() / 1000)));\n              _context.next = 25;\n              break;\n\n            case 22:\n              _context.prev = 22;\n              _context.t0 = _context[\"catch\"](7);\n              dispatch(codeFetchingError(_context.t0.message));\n\n            case 25:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[7, 22]]);\n    };\n  }\n\n  function startCodeFetching() {\n    return {\n      type: FETCH_CODES_START\n    };\n  }\n\n  function codeFetchingSuccess(codes) {\n    return {\n      type: FETCH_CODE_SUCCESS,\n      codes: codes\n    };\n  }\n\n  function codeFetchingError(error) {\n    return {\n      type: FETCH_CODE_ERROR,\n      error: error\n    };\n  }\n\n  function codeLastFetch(lastFetch) {\n    return {\n      type: LAST_FETCH,\n      lastFetch: lastFetch\n    };\n  }\n});","map":[[12,0,1,0],[14,0,2,0],[16,0,4,7],[16,6,4,13,"FETCH_CODES_START"],[16,23,4,30],[16,26,4,33],[16,45,4,7],[18,0,5,7],[18,6,5,13,"FETCH_CODE_SUCCESS"],[18,24,5,31],[18,27,5,34],[18,47,5,7],[20,0,6,7],[20,6,6,13,"FETCH_CODE_ERROR"],[20,22,6,29],[20,25,6,32],[20,43,6,7],[22,0,7,7],[22,6,7,13,"LAST_FETCH"],[22,16,7,23],[22,19,7,26],[22,31,7,7],[25,0,9,7],[25,11,9,16,"fetchCodes"],[25,21,9,7],[25,24,9,29],[26,0,10,4],[26,11,10,11],[26,28,10,18,"dispatch"],[26,36,10,11],[26,38,10,28,"getState"],[26,46,10,11],[27,0,10,11],[28,0,10,11],[29,0,10,11],[30,0,10,11],[31,0,10,11],[32,0,11,8,"dispatch"],[32,14,11,8,"dispatch"],[32,22,11,16],[32,23,11,17,"startCodeFetching"],[32,40,11,34],[32,42,11,16],[32,43,11,8],[33,0,12,14,"state"],[33,14,12,14,"state"],[33,19,10,11],[33,22,12,22,"getState"],[33,30,12,30],[33,32,10,11],[34,0,13,14,"lastFetch"],[34,14,13,14,"lastFetch"],[34,23,10,11],[34,26,13,26,"state"],[34,31,13,31],[34,32,13,32,"codes"],[34,37,13,26],[34,38,13,38,"lastFetch"],[34,47,10,11],[35,0,14,8,"console"],[35,14,14,8,"console"],[35,21,14,15],[35,22,14,16,"log"],[35,25,14,8],[35,26,14,20,"lastFetch"],[35,35,14,8],[37,0,10,11],[37,20,16,11,"lastFetch"],[37,29,16,20],[37,33,16,24,"moment"],[37,49,16,31,"unix"],[37,53,16,24],[37,54,16,36,"lastFetch"],[37,63,16,24],[37,65,16,47,"isAfter"],[37,72,16,24],[37,73,16,55],[37,96,16,64,"subtract"],[37,104,16,55],[37,105,16,73],[37,106,16,55],[37,108,16,76],[37,114,16,55],[37,115,16,24],[37,116,10,11],[38,0,10,11],[39,0,10,11],[40,0,10,11],[42,0,17,12,"dispatch"],[42,14,17,12,"dispatch"],[42,22,17,20],[42,23,17,21,"codeFetchingSuccess"],[42,42,17,40],[42,43,17,41,"state"],[42,48,17,46],[42,49,17,47,"codes"],[42,54,17,41],[42,55,17,53,"codes"],[42,60,17,40],[42,61,17,20],[42,62,17,12],[43,0,10,11],[45,0,10,11],[46,0,10,11],[47,0,22,18,"result"],[47,14,22,18,"result"],[47,20,10,11],[47,23,22,27],[47,25,10,11],[48,0,10,11],[49,0,10,11],[49,48,23,36,"firestore"],[49,68,23,46,"collection"],[49,78,23,36],[49,79,23,57],[49,90,23,36],[49,92,23,70,"limit"],[49,97,23,36],[49,98,23,76],[49,99,23,36],[49,101,23,79,"get"],[49,104,23,36],[49,106,10,11],[51,0,10,11],[52,0,23,18,"companies"],[52,14,23,18,"companies"],[52,23,10,11],[53,0,24,18,"promiseArr"],[53,14,24,18,"promiseArr"],[53,24,10,11],[53,27,24,31],[53,29,10,11],[54,0,26,12,"companies"],[54,14,26,12,"companies"],[54,23,26,21],[54,24,26,22,"forEach"],[54,31,26,12],[54,32,26,30],[54,42,26,30,"company"],[54,49,26,37],[54,51,26,41],[55,0,27,16],[55,20,27,22,"data"],[55,24,27,26],[55,27,27,29,"company"],[55,34,27,36],[55,35,27,37,"data"],[55,39,27,29],[55,41,27,16],[56,0,29,16,"result"],[56,16,29,16,"result"],[56,22,29,22],[56,23,29,23,"push"],[56,27,29,16],[56,28,29,28],[57,0,30,20,"storeName"],[57,18,30,20,"storeName"],[57,27,30,29],[57,29,30,31,"data"],[57,33,30,35],[57,34,30,36,"name"],[57,38,29,28],[58,0,31,20,"logoImage"],[58,18,31,20,"logoImage"],[58,27,31,29],[58,29,31,31,"data"],[58,33,31,35],[58,34,31,36,"logoUrl"],[58,41,29,28],[59,0,32,20,"backgroundImage"],[59,18,32,20,"backgroundImage"],[59,33,32,35],[59,35,32,37,"data"],[59,39,32,41],[59,40,32,42,"backgroundUrl"],[59,53,29,28],[60,0,33,20,"codes"],[60,18,33,20,"codes"],[60,23,33,25],[60,25,33,27],[61,0,29,28],[61,17,29,16],[62,0,36,16,"promiseArr"],[62,16,36,16,"promiseArr"],[62,26,36,26],[62,27,36,27,"push"],[62,31,36,16],[62,32,37,20,"firestore"],[62,52,37,30,"collection"],[62,62,37,20],[62,63,37,41],[62,74,37,20],[62,76,37,54,"doc"],[62,79,37,20],[62,80,37,58,"company"],[62,87,37,65],[62,88,37,66,"id"],[62,90,37,20],[62,92,37,70,"collection"],[62,102,37,20],[62,103,37,81],[62,110,37,20],[62,112,37,90,"get"],[62,115,37,20],[62,117,36,16],[63,0,39,13],[63,15,26,12],[64,0,10,11],[65,0,10,11],[65,48,41,39,"Promise"],[65,55,41,46],[65,56,41,47,"all"],[65,59,41,39],[65,60,41,51,"promiseArr"],[65,70,41,39],[65,71,10,11],[67,0,10,11],[68,0,41,18,"companyCodes"],[68,14,41,18,"companyCodes"],[68,26,10,11],[69,0,43,12,"companyCodes"],[69,14,43,12,"companyCodes"],[69,26,43,24],[69,27,43,25,"forEach"],[69,34,43,12],[69,35,43,33],[69,45,43,34,"item"],[69,49,43,33],[69,51,43,40,"i"],[69,52,43,33],[69,54,43,46],[70,0,45,16],[70,20,45,19],[70,21,45,20,"item"],[70,25,45,24],[70,26,45,25,"empty"],[70,31,45,16],[70,33,45,32],[71,0,46,20,"item"],[71,18,46,20,"item"],[71,22,46,24],[71,23,46,25,"docs"],[71,27,46,20],[71,28,46,30,"forEach"],[71,35,46,20],[71,36,46,38],[71,46,46,38,"code"],[71,50,46,42],[71,52,46,46],[72,0,47,24,"code"],[72,20,47,24,"code"],[72,24,47,28],[72,27,47,31,"code"],[72,31,47,35],[72,32,47,36,"data"],[72,36,47,31],[72,38,47,24],[73,0,48,23],[73,24,48,29,"codeObj"],[73,31,48,36],[73,34,48,39],[74,0,49,27,"name"],[74,22,49,27,"name"],[74,26,49,31],[74,28,49,33,"code"],[74,32,49,37],[74,33,49,38,"name"],[74,37,48,39],[75,0,50,27,"description"],[75,22,50,27,"description"],[75,33,50,38],[75,35,50,40,"code"],[75,39,50,44],[75,40,50,45,"description"],[75,51,48,39],[76,0,51,27,"inStock"],[76,22,51,27,"inStock"],[76,29,51,34],[76,31,51,36,"code"],[76,35,51,40],[76,36,51,41,"currentStock"],[76,48,48,39],[77,0,52,27,"discount"],[77,22,52,27,"discount"],[77,30,52,35],[77,32,52,37,"code"],[77,36,52,41],[77,37,52,42,"discount"],[77,45,48,39],[78,0,53,27,"price"],[78,22,53,27,"price"],[78,27,53,32],[78,29,53,34,"code"],[78,33,53,38],[78,34,53,39,"price"],[79,0,48,39],[79,21,48,23],[80,0,56,23,"result"],[80,20,56,23,"result"],[80,26,56,29],[80,27,56,30,"i"],[80,28,56,29],[80,29,56,23],[80,30,56,33,"codes"],[80,35,56,23],[80,36,56,39,"push"],[80,40,56,23],[80,41,56,44,"codeObj"],[80,48,56,23],[81,0,57,21],[81,19,46,20],[82,0,58,17],[83,0,60,13],[83,15,43,12],[84,0,62,12,"dispatch"],[84,14,62,12,"dispatch"],[84,22,62,20],[84,23,62,21,"codeFetchingSuccess"],[84,42,62,40],[84,43,62,41,"result"],[84,49,62,40],[84,50,62,20],[84,51,62,12],[85,0,63,12,"dispatch"],[85,14,63,12,"dispatch"],[85,22,63,20],[85,23,63,21,"codeLastFetch"],[85,36,63,34],[85,37,63,35,"Math"],[85,41,63,39],[85,42,63,40,"floor"],[85,47,63,35],[85,48,63,46,"Date"],[85,52,63,50],[85,53,63,51,"now"],[85,56,63,46],[85,61,63,59],[85,65,63,35],[85,66,63,34],[85,67,63,20],[85,68,63,12],[86,0,10,11],[87,0,10,11],[89,0,10,11],[90,0,10,11],[91,0,10,11],[92,0,66,12,"dispatch"],[92,14,66,12,"dispatch"],[92,22,66,20],[92,23,66,21,"codeFetchingError"],[92,40,66,38],[92,41,66,39],[92,53,66,45,"message"],[92,60,66,38],[92,61,66,20],[92,62,66,12],[94,0,10,11],[95,0,10,11],[96,0,10,11],[97,0,10,11],[98,0,10,11],[99,0,10,11],[100,0,10,11],[100,5,10,4],[101,0,70,1],[103,0,72,0],[103,11,72,9,"startCodeFetching"],[103,28,72,0],[103,31,72,29],[104,0,73,4],[104,11,73,11],[105,0,74,8,"type"],[105,6,74,8,"type"],[105,10,74,12],[105,12,74,14,"FETCH_CODES_START"],[106,0,73,11],[106,5,73,4],[107,0,76,1],[109,0,78,0],[109,11,78,9,"codeFetchingSuccess"],[109,30,78,0],[109,31,78,29,"codes"],[109,36,78,0],[109,38,78,36],[110,0,79,4],[110,11,79,11],[111,0,80,8,"type"],[111,6,80,8,"type"],[111,10,80,12],[111,12,80,14,"FETCH_CODE_SUCCESS"],[111,30,79,11],[112,0,81,8,"codes"],[112,6,81,8,"codes"],[112,11,81,13],[112,13,81,8,"codes"],[113,0,79,11],[113,5,79,4],[114,0,83,1],[116,0,85,0],[116,11,85,9,"codeFetchingError"],[116,28,85,0],[116,29,85,27,"error"],[116,34,85,0],[116,36,85,34],[117,0,86,4],[117,11,86,11],[118,0,87,8,"type"],[118,6,87,8,"type"],[118,10,87,12],[118,12,87,14,"FETCH_CODE_ERROR"],[118,28,86,11],[119,0,88,8,"error"],[119,6,88,8,"error"],[119,11,88,13],[119,13,88,8,"error"],[120,0,86,11],[120,5,86,4],[121,0,90,1],[123,0,92,0],[123,11,92,9,"codeLastFetch"],[123,24,92,0],[123,25,92,23,"lastFetch"],[123,34,92,0],[123,36,92,34],[124,0,93,4],[124,11,93,11],[125,0,94,8,"type"],[125,6,94,8,"type"],[125,10,94,12],[125,12,94,14,"LAST_FETCH"],[125,22,93,11],[126,0,95,8,"lastFetch"],[126,6,95,8,"lastFetch"],[126,15,95,17],[126,17,95,8,"lastFetch"],[127,0,93,11],[127,5,93,4],[128,0,97,1]]},"type":"js/module"}]}