{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/regenerator","data":{"isAsync":false}},{"name":"moment","data":{"isAsync":false}},{"name":"../../firebase","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.fetchCodes = fetchCodes;\n  exports.LAST_FETCH = exports.FETCH_CODE_ERROR = exports.FETCH_CODE_SUCCESS = exports.FETCH_CODES_START = void 0;\n\n  var _regenerator = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/regenerator\"));\n\n  var _moment = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"moment\"));\n\n  var _firebase = _$$_REQUIRE(_dependencyMap[3], \"../../firebase\");\n\n  var FETCH_CODES_START = 'FETCH_CODES_START';\n  exports.FETCH_CODES_START = FETCH_CODES_START;\n  var FETCH_CODE_SUCCESS = 'FETCH_CODE_SUCCESS';\n  exports.FETCH_CODE_SUCCESS = FETCH_CODE_SUCCESS;\n  var FETCH_CODE_ERROR = 'FETCH_CODE_ERROR';\n  exports.FETCH_CODE_ERROR = FETCH_CODE_ERROR;\n  var LAST_FETCH = 'LAST_FETCH';\n  exports.LAST_FETCH = LAST_FETCH;\n\n  function fetchCodes() {\n    return function _callee(dispatch, getState) {\n      var state, lastFetch, result, companies, promiseArr, companyCodes;\n      return _regenerator.default.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              dispatch(startCodeFetching());\n              state = getState();\n              lastFetch = state.codes.lastFetch;\n\n              if (!(lastFetch && _moment.default.unix(lastFetch).subtract('hour', 1).isAfter((0, _moment.default)().subtract('hour', 1)))) {\n                _context.next = 6;\n                break;\n              }\n\n              dispatch(codeFetchingSuccess(state.codes.codes));\n              return _context.abrupt(\"return\");\n\n            case 6:\n              _context.prev = 6;\n              result = [];\n              _context.next = 10;\n              return _regenerator.default.awrap(_firebase.firestore.collection('companies').limit(5).get());\n\n            case 10:\n              companies = _context.sent;\n              promiseArr = [];\n              companies.forEach(function (company) {\n                var data = company.data();\n                result.push({\n                  storeName: data.name,\n                  logoImage: data.logoUrl,\n                  backgroundImage: data.backgroundUrl,\n                  codes: []\n                });\n                promiseArr.push(_firebase.firestore.collection('companies').doc(company.id).collection('codes').get());\n              });\n              _context.next = 15;\n              return _regenerator.default.awrap(Promise.all(promiseArr));\n\n            case 15:\n              companyCodes = _context.sent;\n              companyCodes.forEach(function (item, i) {\n                if (!item.empty) {\n                  item.docs.forEach(function (code) {\n                    code = code.data();\n                    var codeObj = {\n                      name: code.name,\n                      description: code.description,\n                      inStock: code.currentStock,\n                      discount: code.discount,\n                      price: code.price\n                    };\n                    result[i].codes.push(codeObj);\n                  });\n                }\n              });\n              dispatch(codeFetchingSuccess(result));\n              dispatch(codeLastFetch(Math.floor(Date.now() / 1000)));\n              _context.next = 24;\n              break;\n\n            case 21:\n              _context.prev = 21;\n              _context.t0 = _context[\"catch\"](6);\n              dispatch(codeFetchingError(_context.t0.message));\n\n            case 24:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[6, 21]]);\n    };\n  }\n\n  function startCodeFetching() {\n    return {\n      type: FETCH_CODES_START\n    };\n  }\n\n  function codeFetchingSuccess(codes) {\n    return {\n      type: FETCH_CODE_SUCCESS,\n      codes: codes\n    };\n  }\n\n  function codeFetchingError(error) {\n    return {\n      type: FETCH_CODE_ERROR,\n      error: error\n    };\n  }\n\n  function codeLastFetch(lastFetch) {\n    return {\n      type: LAST_FETCH,\n      lastFetch: lastFetch\n    };\n  }\n});","map":[[12,0,1,0],[14,0,2,0],[16,0,4,7],[16,6,4,13,"FETCH_CODES_START"],[16,23,4,30],[16,26,4,33],[16,45,4,7],[18,0,5,7],[18,6,5,13,"FETCH_CODE_SUCCESS"],[18,24,5,31],[18,27,5,34],[18,47,5,7],[20,0,6,7],[20,6,6,13,"FETCH_CODE_ERROR"],[20,22,6,29],[20,25,6,32],[20,43,6,7],[22,0,7,7],[22,6,7,13,"LAST_FETCH"],[22,16,7,23],[22,19,7,26],[22,31,7,7],[25,0,9,7],[25,11,9,16,"fetchCodes"],[25,21,9,7],[25,24,9,29],[26,0,10,4],[26,11,10,11],[26,28,10,18,"dispatch"],[26,36,10,11],[26,38,10,28,"getState"],[26,46,10,11],[27,0,10,11],[28,0,10,11],[29,0,10,11],[30,0,10,11],[31,0,10,11],[32,0,11,8,"dispatch"],[32,14,11,8,"dispatch"],[32,22,11,16],[32,23,11,17,"startCodeFetching"],[32,40,11,34],[32,42,11,16],[32,43,11,8],[33,0,12,14,"state"],[33,14,12,14,"state"],[33,19,10,11],[33,22,12,22,"getState"],[33,30,12,30],[33,32,10,11],[34,0,13,14,"lastFetch"],[34,14,13,14,"lastFetch"],[34,23,10,11],[34,26,13,26,"state"],[34,31,13,31],[34,32,13,32,"codes"],[34,37,13,26],[34,38,13,38,"lastFetch"],[34,47,10,11],[36,0,10,11],[36,20,16,11,"lastFetch"],[36,29,16,20],[36,33,16,24,"moment"],[36,49,16,31,"unix"],[36,53,16,24],[36,54,16,36,"lastFetch"],[36,63,16,24],[36,65,16,47,"subtract"],[36,73,16,24],[36,74,16,56],[36,80,16,24],[36,82,16,64],[36,83,16,24],[36,85,16,67,"isAfter"],[36,92,16,24],[36,93,16,75],[36,116,16,84,"subtract"],[36,124,16,75],[36,125,16,93],[36,131,16,75],[36,133,16,101],[36,134,16,75],[36,135,16,24],[36,136,10,11],[37,0,10,11],[38,0,10,11],[39,0,10,11],[41,0,17,12,"dispatch"],[41,14,17,12,"dispatch"],[41,22,17,20],[41,23,17,21,"codeFetchingSuccess"],[41,42,17,40],[41,43,17,41,"state"],[41,48,17,46],[41,49,17,47,"codes"],[41,54,17,41],[41,55,17,53,"codes"],[41,60,17,40],[41,61,17,20],[41,62,17,12],[42,0,10,11],[44,0,10,11],[45,0,10,11],[46,0,23,18,"result"],[46,14,23,18,"result"],[46,20,10,11],[46,23,23,27],[46,25,10,11],[47,0,10,11],[48,0,10,11],[48,48,24,36,"firestore"],[48,68,24,46,"collection"],[48,78,24,36],[48,79,24,57],[48,90,24,36],[48,92,24,70,"limit"],[48,97,24,36],[48,98,24,76],[48,99,24,36],[48,101,24,79,"get"],[48,104,24,36],[48,106,10,11],[50,0,10,11],[51,0,24,18,"companies"],[51,14,24,18,"companies"],[51,23,10,11],[52,0,25,18,"promiseArr"],[52,14,25,18,"promiseArr"],[52,24,10,11],[52,27,25,31],[52,29,10,11],[53,0,27,12,"companies"],[53,14,27,12,"companies"],[53,23,27,21],[53,24,27,22,"forEach"],[53,31,27,12],[53,32,27,30],[53,42,27,30,"company"],[53,49,27,37],[53,51,27,41],[54,0,28,16],[54,20,28,22,"data"],[54,24,28,26],[54,27,28,29,"company"],[54,34,28,36],[54,35,28,37,"data"],[54,39,28,29],[54,41,28,16],[55,0,30,16,"result"],[55,16,30,16,"result"],[55,22,30,22],[55,23,30,23,"push"],[55,27,30,16],[55,28,30,28],[56,0,31,20,"storeName"],[56,18,31,20,"storeName"],[56,27,31,29],[56,29,31,31,"data"],[56,33,31,35],[56,34,31,36,"name"],[56,38,30,28],[57,0,32,20,"logoImage"],[57,18,32,20,"logoImage"],[57,27,32,29],[57,29,32,31,"data"],[57,33,32,35],[57,34,32,36,"logoUrl"],[57,41,30,28],[58,0,33,20,"backgroundImage"],[58,18,33,20,"backgroundImage"],[58,33,33,35],[58,35,33,37,"data"],[58,39,33,41],[58,40,33,42,"backgroundUrl"],[58,53,30,28],[59,0,34,20,"codes"],[59,18,34,20,"codes"],[59,23,34,25],[59,25,34,27],[60,0,30,28],[60,17,30,16],[61,0,37,16,"promiseArr"],[61,16,37,16,"promiseArr"],[61,26,37,26],[61,27,37,27,"push"],[61,31,37,16],[61,32,38,20,"firestore"],[61,52,38,30,"collection"],[61,62,38,20],[61,63,38,41],[61,74,38,20],[61,76,38,54,"doc"],[61,79,38,20],[61,80,38,58,"company"],[61,87,38,65],[61,88,38,66,"id"],[61,90,38,20],[61,92,38,70,"collection"],[61,102,38,20],[61,103,38,81],[61,110,38,20],[61,112,38,90,"get"],[61,115,38,20],[61,117,37,16],[62,0,40,13],[62,15,27,12],[63,0,10,11],[64,0,10,11],[64,48,42,39,"Promise"],[64,55,42,46],[64,56,42,47,"all"],[64,59,42,39],[64,60,42,51,"promiseArr"],[64,70,42,39],[64,71,10,11],[66,0,10,11],[67,0,42,18,"companyCodes"],[67,14,42,18,"companyCodes"],[67,26,10,11],[68,0,44,12,"companyCodes"],[68,14,44,12,"companyCodes"],[68,26,44,24],[68,27,44,25,"forEach"],[68,34,44,12],[68,35,44,33],[68,45,44,34,"item"],[68,49,44,33],[68,51,44,40,"i"],[68,52,44,33],[68,54,44,46],[69,0,46,16],[69,20,46,19],[69,21,46,20,"item"],[69,25,46,24],[69,26,46,25,"empty"],[69,31,46,16],[69,33,46,32],[70,0,47,20,"item"],[70,18,47,20,"item"],[70,22,47,24],[70,23,47,25,"docs"],[70,27,47,20],[70,28,47,30,"forEach"],[70,35,47,20],[70,36,47,38],[70,46,47,38,"code"],[70,50,47,42],[70,52,47,46],[71,0,48,24,"code"],[71,20,48,24,"code"],[71,24,48,28],[71,27,48,31,"code"],[71,31,48,35],[71,32,48,36,"data"],[71,36,48,31],[71,38,48,24],[72,0,49,23],[72,24,49,29,"codeObj"],[72,31,49,36],[72,34,49,39],[73,0,50,27,"name"],[73,22,50,27,"name"],[73,26,50,31],[73,28,50,33,"code"],[73,32,50,37],[73,33,50,38,"name"],[73,37,49,39],[74,0,51,27,"description"],[74,22,51,27,"description"],[74,33,51,38],[74,35,51,40,"code"],[74,39,51,44],[74,40,51,45,"description"],[74,51,49,39],[75,0,52,27,"inStock"],[75,22,52,27,"inStock"],[75,29,52,34],[75,31,52,36,"code"],[75,35,52,40],[75,36,52,41,"currentStock"],[75,48,49,39],[76,0,53,27,"discount"],[76,22,53,27,"discount"],[76,30,53,35],[76,32,53,37,"code"],[76,36,53,41],[76,37,53,42,"discount"],[76,45,49,39],[77,0,54,27,"price"],[77,22,54,27,"price"],[77,27,54,32],[77,29,54,34,"code"],[77,33,54,38],[77,34,54,39,"price"],[78,0,49,39],[78,21,49,23],[79,0,57,23,"result"],[79,20,57,23,"result"],[79,26,57,29],[79,27,57,30,"i"],[79,28,57,29],[79,29,57,23],[79,30,57,33,"codes"],[79,35,57,23],[79,36,57,39,"push"],[79,40,57,23],[79,41,57,44,"codeObj"],[79,48,57,23],[80,0,58,21],[80,19,47,20],[81,0,59,17],[82,0,61,13],[82,15,44,12],[83,0,63,12,"dispatch"],[83,14,63,12,"dispatch"],[83,22,63,20],[83,23,63,21,"codeFetchingSuccess"],[83,42,63,40],[83,43,63,41,"result"],[83,49,63,40],[83,50,63,20],[83,51,63,12],[84,0,64,12,"dispatch"],[84,14,64,12,"dispatch"],[84,22,64,20],[84,23,64,21,"codeLastFetch"],[84,36,64,34],[84,37,64,35,"Math"],[84,41,64,39],[84,42,64,40,"floor"],[84,47,64,35],[84,48,64,46,"Date"],[84,52,64,50],[84,53,64,51,"now"],[84,56,64,46],[84,61,64,59],[84,65,64,35],[84,66,64,34],[84,67,64,20],[84,68,64,12],[85,0,10,11],[86,0,10,11],[88,0,10,11],[89,0,10,11],[90,0,10,11],[91,0,67,12,"dispatch"],[91,14,67,12,"dispatch"],[91,22,67,20],[91,23,67,21,"codeFetchingError"],[91,40,67,38],[91,41,67,39],[91,53,67,45,"message"],[91,60,67,38],[91,61,67,20],[91,62,67,12],[93,0,10,11],[94,0,10,11],[95,0,10,11],[96,0,10,11],[97,0,10,11],[98,0,10,11],[99,0,10,11],[99,5,10,4],[100,0,71,1],[102,0,73,0],[102,11,73,9,"startCodeFetching"],[102,28,73,0],[102,31,73,29],[103,0,74,4],[103,11,74,11],[104,0,75,8,"type"],[104,6,75,8,"type"],[104,10,75,12],[104,12,75,14,"FETCH_CODES_START"],[105,0,74,11],[105,5,74,4],[106,0,77,1],[108,0,79,0],[108,11,79,9,"codeFetchingSuccess"],[108,30,79,0],[108,31,79,29,"codes"],[108,36,79,0],[108,38,79,36],[109,0,80,4],[109,11,80,11],[110,0,81,8,"type"],[110,6,81,8,"type"],[110,10,81,12],[110,12,81,14,"FETCH_CODE_SUCCESS"],[110,30,80,11],[111,0,82,8,"codes"],[111,6,82,8,"codes"],[111,11,82,13],[111,13,82,8,"codes"],[112,0,80,11],[112,5,80,4],[113,0,84,1],[115,0,86,0],[115,11,86,9,"codeFetchingError"],[115,28,86,0],[115,29,86,27,"error"],[115,34,86,0],[115,36,86,34],[116,0,87,4],[116,11,87,11],[117,0,88,8,"type"],[117,6,88,8,"type"],[117,10,88,12],[117,12,88,14,"FETCH_CODE_ERROR"],[117,28,87,11],[118,0,89,8,"error"],[118,6,89,8,"error"],[118,11,89,13],[118,13,89,8,"error"],[119,0,87,11],[119,5,87,4],[120,0,91,1],[122,0,93,0],[122,11,93,9,"codeLastFetch"],[122,24,93,0],[122,25,93,23,"lastFetch"],[122,34,93,0],[122,36,93,34],[123,0,94,4],[123,11,94,11],[124,0,95,8,"type"],[124,6,95,8,"type"],[124,10,95,12],[124,12,95,14,"LAST_FETCH"],[124,22,94,11],[125,0,96,8,"lastFetch"],[125,6,96,8,"lastFetch"],[125,15,96,17],[125,17,96,8,"lastFetch"],[126,0,94,11],[126,5,94,4],[127,0,98,1]]},"type":"js/module"}]}